(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"1LK5":function(t,e){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},"7cXV":function(t,e,n){var o=n("LqpT"),r=n("XGnz"),i=n("LGYb");t.exports=function(t,e,n){var a=t.length;if(a<2)return a?i(t[0]):[];for(var s=-1,c=Array(a);++s<a;)for(var l=t[s],u=-1;++u<a;)u!=s&&(c[s]=o(c[s]||l,t[u],e,n));return i(r(c,1),e,n)}},HxfT:function(t,e,n){"use strict";n.r(e);var o=n("ANjH"),r=n("/MKj"),i=n("LCzB"),a=n("H2TA"),s=n("TYy9"),c=n.n(s),l=n("ZQa3"),u=n("q1tI"),f=n.n(u),d=n("sEfC"),h=n.n(d),v=n("Y+p1"),p=n.n(v),g=n("qnjL"),y=n.n(g),w=n("TSYQ"),m=n.n(w),b=n("k+jv"),O=n("i8i4"),A=n.n(O),j=n("xweI"),I=n.n(j),x=n("Qcb2"),C=n.n(x);function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var S=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1}var e,n,o;return e=t,(n=[{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new y.a.Point(0,0);var t=this.viewer.viewport.getBoundsNoRotate(!0);this.viewportOrigin.x=t.x,this.viewportOrigin.y=t.y*this.imgAspectRatio,this.viewportWidth=t.width,this.viewportHeight=t.height*this.imgAspectRatio;var e=this.viewer.world.getItemAt(0);e&&(this.imgWidth=e.source.dimensions.x,this.imgHeight=e.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(t){var e=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var o=n.viewportToImageZoom(e),r=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,i=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(r,i),this.context2d.scale(o,o);var a=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*a.x,0),this.context2d.scale(-1,1));var s=this.viewer.viewport.getRotation();0!==s&&(this.context2d.translate(a.x,a.y),this.context2d.rotate(s*Math.PI/180),this.context2d.translate(-1*a.x,-1*a.y)),t(),this.context2d.setTransform(1,0,0,1,0,0)}}},{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}}])&&k(e.prototype,n),o&&k(e,o),t}();function P(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function T(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var W=function(){function t(e){var n=e.resource,o=e.palette,r=e.zoomRatio,i=e.offset,a=e.selected,s=e.hovered;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resource=n,this.palette=o,this.zoomRatio=r,this.offset=i,this.selected=a,this.hovered=s}var e,n,o;return e=t,(n=[{key:"toContext",value:function(t){this.context=t,this.resource.svgSelector?this.svgContext():this.fragmentContext()}},{key:"svgContext",value:function(){var t,e=this;0!==(t=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&P(this.svgPaths).forEach((function(n){e.context.save(),e.context.translate(e.offset.x,e.offset.y);var o=new Path2D(n.attributes.d.nodeValue);e.context.strokeStyle=e.color,n.attributes["stroke-dasharray"]&&e.context.setLineDash(n.attributes["stroke-dasharray"].nodeValue.split(","));var r={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(r).forEach((function(t){n.attributes[t]&&(e.context[r[t]]=n.attributes[t].nodeValue)})),e.context.lineWidth/=e.zoomRatio,(e.selected||e.hovered)&&(e.context.strokeStyle=t.strokeStyle||t.fillStyle),n.attributes["stroke-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["stroke-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.stroke(o),n.attributes.fill&&"none"!==n.attributes.fill.nodeValue&&(n.attributes["fill-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["fill-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.fill(o)),e.context.restore()}))}},{key:"fragmentContext",value:function(){var t,e,n,o=this,r=this.resource.fragmentSelector;(r[0]+=this.offset.x,r[1]+=this.offset.y,t=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(t).forEach((function(e){o.context[e]=t[e]})),0!==t.globalAlpha)&&(t.fillStyle?(e=this.context).fillRect.apply(e,P(r)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,P(r))),this.context.restore())}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgPaths",get:function(){return(new DOMParser).parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}])&&T(e.prototype,n),o&&T(e,o),t}();function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){D(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function D(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function H(t){return function(t){if(Array.isArray(t))return U(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||V(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(t,e)||V(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(t,e){if(t){if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function F(t,e,n){return e&&_(t.prototype,e),n&&_(t,n),t}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function X(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=N(t);if(e){var r=N(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return L(this,n)}}function L(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?Z(t):e}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(n,t);var e=X(n);function n(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=e.call(this,t)).ref=f.a.createRef(),o.osdCanvasOverlay=null,o.updateCanvas=function(){},o.onUpdateViewport=o.onUpdateViewport.bind(Z(o)),o.onCanvasClick=o.onCanvasClick.bind(Z(o)),o.onCanvasMouseMove=h()(o.onCanvasMouseMove.bind(Z(o)),10),o.onCanvasExit=o.onCanvasExit.bind(Z(o)),o}return F(n,null,[{key:"annotationsMatch",value:function(t,e){return!t&&!e||!(t&&!e||!t&&e)&&(0===t.length&&0===e.length||t.length===e.length&&t.every((function(t,n){var o=t.resources.map((function(t){return t.id})),r=e[n].resources.map((function(t){return t.id}));return 0===o.length&&0===r.length||o.length===r.length&&!(t.id!==e[n].id||!p()(o,r))})))}}]),F(n,[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(t){var e=this.props,o=e.drawAnnotations,r=e.drawSearchAnnotations,i=e.annotations,a=e.searchAnnotations,s=e.hoveredAnnotationIds,c=e.selectedAnnotationId,l=e.highlightAllAnnotations,u=e.viewer;this.initializeViewer();var f=!n.annotationsMatch(i,t.annotations),d=!n.annotationsMatch(a,t.searchAnnotations),h=C()(s,t.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&h&&(s.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var v=c!==t.selectedAnnotationId,p=o!==t.drawAnnotations||r!==t.drawSearchAnnotations||l!==t.highlightAllAnnotations;(d||f||v||h||p)&&(this.updateCanvas=this.canvasUpdateCallback(),u.forceRedraw())}},{key:"componentWillUnmount",value:function(){var t=this.props.viewer;t.removeHandler("canvas-click",this.onCanvasClick),t.removeHandler("canvas-exit",this.onCanvasExit),t.removeHandler("update-viewport",this.onUpdateViewport),t.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(t){var e=this,n=this.props.canvasWorld,o=t.position,r=t.eventSource.viewport.pointFromPixel(o),i=n.canvasAtPoint(r);if(i){var a=z(n.canvasToWorldCoordinates(i.id),4),s=(a[0],a[1],a[2]),c=a[3],l=this.annotationsAtPoint(i,r);if(l.length>0&&(t.preventDefaultAction=!0),1===l.length)this.toggleAnnotation(l[0].id);else if(l.length>0){var u=function(t){var n=Math.PI/180;return function(o){for(var a=0,s=0;s<360;s+=1){var c=Math.cos(s*n)*t+r.x,l=Math.sin(s*n)*t+r.y;e.isAnnotationAtPoint(o,i,{x:c,y:l})&&(a+=1)}return{anno:o,score:a}}},f=[],d=1;for(f=I()(l.map(u(d)),"score");d<Math.max(s,c)&&f[0].score===f[1].score;)d*=2,f=I()(l.map(u(d)),"score");this.toggleAnnotation(f[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(t){var e=this.props,n=e.annotations,o=e.canvasWorld,r=e.hoverAnnotation,i=e.hoveredAnnotationIds,a=e.searchAnnotations,s=e.viewer,c=e.windowId;if(0!==n.length||0!==a.length){var l=t.position,u=s.viewport.pointFromPixel(l),f=o.canvasAtPoint(u);if(f){var d=this.annotationsAtPoint(f,u);C()(i,d.map((function(t){return t.id}))).length>0&&r(c,d.map((function(t){return t.id})))}else r(c,[])}}},{key:"onCanvasExit",value:function(t){var e=this.props,n=e.hoverAnnotation,o=e.windowId;this.onCanvasMouseMove.cancel(),n(o,[])}},{key:"onUpdateViewport",value:function(t){this.updateCanvas()}},{key:"initializeViewer",value:function(){var t=this.props.viewer;t&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new S(t,this.ref),t.addHandler("canvas-click",this.onCanvasClick),t.addHandler("canvas-exit",this.onCanvasExit),t.addHandler("update-viewport",this.onUpdateViewport),t.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var t=this;return function(){t.osdCanvasOverlay.clear(),t.osdCanvasOverlay.resize(),t.osdCanvasOverlay.canvasUpdate(t.renderAnnotations.bind(t))}}},{key:"isAnnotationAtPoint",value:function(t,e,n){var o=z(this.props.canvasWorld.canvasToWorldCoordinates(e.id),2),r=o[0],i=o[1],a=n.x-r,s=n.y-i;if(t.svgSelector){var c=this.osdCanvasOverlay.context2d;return H(new W({resource:t}).svgPaths).some((function(t){return c.isPointInPath(new Path2D(t.attributes.d.nodeValue),a,s)}))}if(t.fragmentSelector){var l=z(t.fragmentSelector,4),u=l[0],f=l[1],d=l[2],h=l[3];return u<=a&&a<=u+d&&f<=s&&s<=f+h}return!1}},{key:"annotationsAtPoint",value:function(t,e){var n=this,o=this.props,r=o.annotations,i=o.searchAnnotations,a=[].concat(H(r),H(i));return c()(a.map((function(t){return t.resources}))).filter((function(o){return t.id===o.targetId&&n.isAnnotationAtPoint(o,t,e)}))}},{key:"toggleAnnotation",value:function(t){var e=this.props,n=e.selectedAnnotationId,o=e.selectAnnotation,r=e.deselectAnnotation,i=e.windowId;n===t?r(i,t):o(i,t)}},{key:"annotationsToContext",value:function(t,e){var n=this.props,o=n.highlightAllAnnotations,r=n.hoveredAnnotationIds,i=n.selectedAnnotationId,a=n.canvasWorld,s=n.viewer,c=this.osdCanvasOverlay.context2d,l=s.viewport.getZoom(!0)/s.viewport.getMaxZoom();t.forEach((function(t){t.resources.forEach((function(t){if(a.canvasIds.includes(t.targetId)){var n=a.offsetByCanvas(t.targetId);new W({hovered:r.includes(t.id),offset:n,palette:E(E({},e),{},{default:E(E({},e.default),!o&&e.hidden)}),resource:t,selected:i===t.id,zoomRatio:l}).toContext(c)}}))}))}},{key:"renderAnnotations",value:function(){var t=this.props,e=t.annotations,n=t.drawAnnotations,o=t.drawSearchAnnotations,r=t.searchAnnotations,i=t.palette;o&&this.annotationsToContext(r,i.search),n&&this.annotationsToContext(e,i.annotations)}},{key:"render",value:function(){var t=this.props.viewer;return t?A.a.createPortal(f.a.createElement("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},f.a.createElement("canvas",null)),t.canvas):f.a.createElement(f.a.Fragment,null)}}]),n}(u.Component);K.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var Y=n("w/HO"),q=n("iIe7"),Q=n("/kll"),G=n("p0mk"),J=n("ZKdt"),$=n("rDDf"),tt=n("zDv4"),et={deselectAnnotation:Y.a,hoverAnnotation:Y.b,selectAnnotation:Y.g},nt=Object(o.compose)(Object(i.a)(),Object(r.b)((function(t,e){var n=e.windowId;return{annotations:Object(q.d)(t,{windowId:n}),canvasWorld:Object(Q.a)(t,{windowId:n}),drawAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(J.e)(t,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(J.e)(t,{content:"search",windowId:n}).length>0,highlightAllAnnotations:Object($.e)(t,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:Object($.e)(t,{windowId:n}).hoveredAnnotationIds,palette:Object(G.g)(t).palette,searchAnnotations:Object(tt.f)(t,{windowId:n}),selectedAnnotationId:Object(q.e)(t,{windowId:n})}}),et),Object(l.a)("AnnotationsOverlay"))(K),ot=n("NnuU"),rt={get:function(t){return this.refs[t]},refs:{},set:function(t,e){this.refs[t]=e}};function it(t,e,n){return(it=pt()?Reflect.construct:function(t,e,n){var o=[null];o.push.apply(o,e);var r=new(Function.bind.apply(t,o));return n&&dt(r,n.prototype),r}).apply(null,arguments)}function at(t){return function(t){if(Array.isArray(t))return st(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return st(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach((function(e){ut(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ut(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ft(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dt(t,e){return(dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ht(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?vt(t):e}function vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dt(t,e)}(s,t);var e,n,o,r,i,a=(e=s,n=pt(),function(){var t,o=gt(e);if(n){var r=gt(this).constructor;t=Reflect.construct(o,arguments,r)}else t=o.apply(this,arguments);return ht(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this,t)).state={viewer:void 0},e.ref=f.a.createRef(),e.apiRef=f.a.createRef(),rt.set(t.windowId,e.apiRef),e.onCanvasMouseMove=h()(e.onCanvasMouseMove.bind(vt(e)),10),e.onViewportChange=e.onViewportChange.bind(vt(e)),e.zoomToWorld=e.zoomToWorld.bind(vt(e)),e.osdUpdating=!1,e}return o=s,(r=[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.osdConfig,o=e.t,r=e.windowId;if(this.ref.current){var i=new y.a(lt({id:this.ref.current.id},n)),a=i.canvas&&i.canvas.firstElementChild;a&&(a.setAttribute("role","img"),a.setAttribute("aria-label",o("digitizedView")),a.setAttribute("aria-describedby","".concat(r,"-osd"))),this.apiRef.current=i,this.setState({viewer:i}),i.addHandler("animation-start",(function(){t.osdUpdating=!0})),i.addHandler("animation-finish",this.onViewportChange),i.addHandler("animation-finish",(function(){t.osdUpdating=!1})),i.innerTracker&&(i.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(t,e){var n=this.props,o=n.viewerConfig,r=n.canvasWorld,i=this.state.viewer;if(this.apiRef.current=i,void 0===e.viewer)return o&&(i.viewport.panTo(o,!0),i.viewport.zoomTo(o.zoom,o,!0),void 0!==o.degrees&&i.viewport.setRotation(o.degrees),void 0!==o.flip&&i.viewport.setFlip(o.flip)),void this.addAllImageSources(!o);if(this.infoResponsesMatch(t.infoResponses)&&this.nonTiledImagedMatch(t.nonTiledImages))if(p()(r.layers,t.canvasWorld.layers)){if(o&&!this.osdUpdating){var a=i.viewport;o.x===a.centerSpringX.target.value&&o.y===a.centerSpringY.target.value||a.panTo(o,!1),o.zoom!==a.zoomSpring.target.value&&a.zoomTo(o.zoom,o,!1),o.rotation!==a.getRotation()&&a.setRotation(o.rotation),o.flip!==a.getFlip()&&a.setFlip(o.flip)}}else this.refreshTileProperties();else{i.close();var s=!p()(r.canvasIds,t.canvasWorld.canvasIds);this.addAllImageSources(s||!o)}}},{key:"componentWillUnmount",value:function(){var t=this.state.viewer;t.innerTracker&&t.innerTracker.moveHandler===this.onCanvasMouseMove&&(t.innerTracker.moveHandler=null),t.removeAllHandlers(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(t){this.state.viewer.raiseEvent("mouse-move",t)}},{key:"onViewportChange",value:function(t){var e=this.props,n=e.updateViewport,o=e.windowId,r=t.eventSource.viewport;n(o,{flip:r.getFlip(),rotation:r.getRotation(),x:Math.round(r.centerSpringX.target.value),y:Math.round(r.centerSpringY.target.value),zoom:r.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.props,o=n.nonTiledImages,r=n.infoResponses;Promise.all(r.map((function(e){return t.addTileSource(e)})),o.map((function(e){return t.addNonTiledImage(e)}))).then((function(){(r[0]||o[0])&&(e&&t.zoomToWorld(),t.refreshTileProperties())}))}},{key:"addNonTiledImage",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer,o=t.getProperty("type"),r=t.getProperty("format")||"";return"Image"===o||"dctypes:Image"===o||r.startsWith("image/")?new Promise((function(o,r){n||r(),n.addSimpleImage({error:function(t){return r(t)},fitBounds:it(y.a.Rect,at(e.contentResourceToWorldCoordinates(t))),index:e.layerIndexOfImageResource(t),opacity:e.layerOpacityOfImageResource(t),success:function(t){return o(t)},url:t.id})})):Promise.resolve()}},{key:"addTileSource",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer;return new Promise((function(o,r){n||r();var i=lt({},t.json),a=e.contentResource(t.id);a&&n.addTiledImage({error:function(t){return r(t)},fitBounds:it(y.a.Rect,at(e.contentResourceToWorldCoordinates(a))),index:e.layerIndexOfImageResource(a),opacity:e.layerOpacityOfImageResource(a),success:function(t){return o(t)},tileSource:i})}))}},{key:"refreshTileProperties",value:function(){for(var t=this.props.canvasWorld,e=this.state.viewer.world,n=[],o=0;o<e.getItemCount();o+=1)n.push(e.getItemAt(o));n.forEach((function(n,o){var r=t.contentResource(n.source["@id"]||n.source.id);if(r){var i=t.layerIndexOfImageResource(r);o!==i&&e.setItemIndex(n,i),n.setOpacity(t.layerOpacityOfImageResource(r))}}))}},{key:"fitBounds",value:function(t,e,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=this.state.viewer;i.viewport.fitBounds(new y.a.Rect(t,e,n,o),r)}},{key:"infoResponsesMatch",value:function(t){var e=this.props.infoResponses;return 0===e.length&&0===t.length||e.length===t.length&&e.every((function(e,n){return!!(t[n]&&e.json&&t[n].json&&e.tokenServiceId===t[n].tokenServiceId&&(e.json["@id"]&&e.json["@id"]===t[n].json["@id"]||e.json.id&&e.json.id===t[n].json.id))}))}},{key:"nonTiledImagedMatch",value:function(t){var e=this.props.nonTiledImages;return 0===e.length&&0===t.length||e.some((function(e,n){return!!t[n]&&e.id===t[n].id}))}},{key:"zoomToWorld",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.props.canvasWorld;this.fitBounds.apply(this,at(e.worldBounds()).concat([t]))}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.classes,r=e.label,i=e.t,a=e.windowId,s=e.drawAnnotations,c=this.state.viewer,l=f.a.Children.map(n,(function(e){return f.a.cloneElement(e,{zoomToWorld:t.zoomToWorld})}));return f.a.createElement(f.a.Fragment,null,f.a.createElement("section",{className:m()(Object(b.a)("osd-container"),o.osdContainer),id:"".concat(a,"-osd"),ref:this.ref,"aria-label":i("item",{label:r}),"aria-live":"polite"},s&&f.a.createElement(nt,{viewer:c,windowId:a}),l,f.a.createElement(ot.a,Object.assign({viewer:c},lt(lt({},this.props),{},{children:null})))))}}])&&ft(o.prototype,r),i&&ft(o,i),s}(u.Component);yt.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var wt=n("KqvR"),mt=n("2wSK"),bt={updateViewport:wt.d},Ot=Object(o.compose)(Object(a.a)({osdContainer:{flex:1,position:"relative"}}),Object(i.a)(),Object(r.b)((function(t,e){var n=e.windowId,o=Object(Q.a)(t,{windowId:n}),r=Object(mt.q)(t),i=c()(o.canvases.map((function(t){return t.imageServiceIds})));return{canvasWorld:o,drawAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(J.e)(t,{content:"annotations",windowId:n}).length>0||Object(J.e)(t,{content:"search",windowId:n}).length>0,infoResponses:i.map((function(t){return r[t]})).filter((function(t){return void 0!==t&&!1===t.isFetching&&void 0===t.error})),label:Object(mt.e)(t,{canvasId:(Object(mt.g)(t,{windowId:n})||{}).id,windowId:n}),nonTiledImages:Object(mt.m)(t,{windowId:n}),osdConfig:Object(G.a)(t).osdConfig,viewerConfig:Object($.d)(t,{windowId:n})}}),bt),Object(l.a)("OpenSeadragonViewer"));e.default=Ot(yt)},IWTy:function(t,e,n){var o=n("yue5");t.exports=function(t,e,n){for(var r=-1,i=t.criteria,a=e.criteria,s=i.length,c=n.length;++r<s;){var l=o(i[r],a[r]);if(l)return r>=c?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}},Qcb2:function(t,e,n){var o=n("LXxW"),r=n("EA7m"),i=n("7cXV"),a=n("3L66"),s=r((function(t){return i(o(t,a))}));t.exports=s},alwl:function(t,e,n){var o=n("eUgh"),r=n("ZWtO"),i=n("ut/Y"),a=n("l9OW"),s=n("1LK5"),c=n("sEf8"),l=n("IWTy"),u=n("zZ0H"),f=n("Z0cm");t.exports=function(t,e,n){e=e.length?o(e,(function(t){return f(t)?function(e){return r(e,1===t.length?t[0]:t)}:t})):[u];var d=-1;e=o(e,c(i));var h=a(t,(function(t,n,r){return{criteria:o(e,(function(e){return e(t)})),index:++d,value:t}}));return s(h,(function(t,e){return l(t,e,n)}))}},l9OW:function(t,e,n){var o=n("SKAX"),r=n("MMmD");t.exports=function(t,e){var n=-1,i=r(t)?Array(t.length):[];return o(t,(function(t,o,r){i[++n]=e(t,o,r)})),i}},"mv/X":function(t,e,n){var o=n("ljhN"),r=n("MMmD"),i=n("wJg7"),a=n("GoyQ");t.exports=function(t,e,n){if(!a(n))return!1;var s=typeof e;return!!("number"==s?r(n)&&i(e,n.length):"string"==s&&e in n)&&o(n[e],t)}},xweI:function(t,e,n){var o=n("XGnz"),r=n("alwl"),i=n("EA7m"),a=n("mv/X"),s=i((function(t,e){if(null==t)return[];var n=e.length;return n>1&&a(t,e[0],e[1])?e=[]:n>2&&a(e[0],e[1],e[2])&&(e=[e[0]]),r(t,o(e,1),[])}));t.exports=s},yue5:function(t,e,n){var o=n("/9aa");t.exports=function(t,e){if(t!==e){var n=void 0!==t,r=null===t,i=t==t,a=o(t),s=void 0!==e,c=null===e,l=e==e,u=o(e);if(!c&&!u&&!a&&t>e||a&&s&&l&&!c&&!u||r&&s&&l||!n&&l||!i)return 1;if(!r&&!a&&!u&&t<e||u&&n&&i&&!r&&!a||c&&n&&i||!s&&i||!l)return-1}return 0}}}]);
//# sourceMappingURL=12-29837e0da5c47580f21f.js.map