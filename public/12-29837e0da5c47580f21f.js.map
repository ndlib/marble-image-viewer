{"version":3,"sources":["webpack:///./node_modules/lodash/_baseSortBy.js","webpack:///./node_modules/lodash/_baseXor.js","webpack:///./node_modules/mirador/dist/es/src/lib/OpenSeadragonCanvasOverlay.js","webpack:///./node_modules/mirador/dist/es/src/lib/CanvasAnnotationDisplay.js","webpack:///./node_modules/mirador/dist/es/src/components/AnnotationsOverlay.js","webpack:///./node_modules/mirador/dist/es/src/containers/AnnotationsOverlay.js","webpack:///./node_modules/mirador/dist/es/src/plugins/OSDReferences.js","webpack:///./node_modules/mirador/dist/es/src/components/OpenSeadragonViewer.js","webpack:///./node_modules/mirador/dist/es/src/containers/OpenSeadragonViewer.js","webpack:///./node_modules/lodash/_compareMultiple.js","webpack:///./node_modules/lodash/xor.js","webpack:///./node_modules/lodash/_baseOrderBy.js","webpack:///./node_modules/lodash/_baseMap.js","webpack:///./node_modules/lodash/_isIterateeCall.js","webpack:///./node_modules/lodash/sortBy.js","webpack:///./node_modules/lodash/_compareAscending.js"],"names":["module","exports","array","comparer","length","sort","value","baseDifference","baseFlatten","baseUniq","arrays","iteratee","comparator","index","result","Array","othIndex","_defineProperties","target","props","i","descriptor","enumerable","configurable","writable","Object","defineProperty","key","OpenSeadragonCanvasOverlay","viewer","ref","instance","Constructor","TypeError","_classCallCheck","this","containerWidth","containerHeight","imgAspectRatio","protoProps","staticProps","context2d","clearRect","container","clientWidth","canvasDiv","setAttribute","canvas","clientHeight","viewportOrigin","Point","boundsRect","viewport","getBoundsNoRotate","x","y","viewportWidth","width","viewportHeight","height","image1","world","getItemAt","imgWidth","source","dimensions","imgHeight","update","viewportZoom","getZoom","zoom","viewportToImageZoom","clearBeforeRedraw","clear","translate","scale","center","getCenter","getFlip","rotation","getRotation","rotate","Math","PI","setTransform","get","firstElementChild","current","getContext","prototype","_toConsumableArray","arr","isArray","_arrayLikeToArray","_arrayWithoutHoles","iter","Symbol","iterator","from","_iterableToArray","o","minLen","n","toString","call","slice","constructor","name","test","_unsupportedIterableToArray","_nonIterableSpread","len","arr2","CanvasAnnotationDisplay","_ref","resource","palette","zoomRatio","offset","selected","hovered","context","svgSelector","svgContext","fragmentContext","currentPalette","_this","globalAlpha","svgPaths","forEach","element","save","p","Path2D","attributes","d","nodeValue","strokeStyle","color","setLineDash","split","svgToCanvasMap","fill","stroke","keys","lineWidth","fillStyle","restore","_this$context","_this$context2","_this2","fragment","fragmentSelector","fillRect","apply","strokeRect","DOMParser","parseFromString","svgString","getElementsByTagName","ownKeys","object","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","_objectSpread","arguments","_defineProperty","getOwnPropertyDescriptors","defineProperties","obj","_slicedToArray","_arrayWithHoles","_arr","_n","_d","_e","undefined","_s","_i","next","done","err","_iterableToArrayLimit","_nonIterableRest","_setPrototypeOf","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","e","_isNativeReflectConstruct","Super","_getPrototypeOf","NewTarget","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","getPrototypeOf","_Component","subClass","superClass","create","_inherits","AnnotationsOverlay","_super","createRef","osdCanvasOverlay","updateCanvas","onUpdateViewport","bind","onCanvasClick","onCanvasMouseMove","onCanvasExit","currentAnnotations","prevAnnotations","every","annotation","newIds","resources","map","r","id","prevIds","initializeViewer","prevProps","_this$props","drawAnnotations","drawSearchAnnotations","annotations","searchAnnotations","hoveredAnnotationIds","selectedAnnotationId","highlightAllAnnotations","annotationsUpdated","annotationsMatch","searchAnnotationsUpdated","hoveredAnnotationsUpdated","style","cursor","selectedAnnotationsUpdated","redrawAnnotations","canvasUpdateCallback","forceRedraw","removeHandler","event","canvasWorld","webPosition","position","point","eventSource","pointFromPixel","canvasAtPoint","_canvasWorld$canvasTo2","canvasToWorldCoordinates","canvasWidth","canvasHeight","annos","annotationsAtPoint","preventDefaultAction","toggleAnnotation","annosWithClickScore","radius","degreesToRadians","anno","score","degrees","cos","sin","isAnnotationAtPoint","annosWithScore","max","_this$props2","hoverAnnotation","windowId","a","_this$props3","cancel","addHandler","_this3","resize","canvasUpdate","renderAnnotations","_canvasWorld$canvasTo4","canvasX","canvasY","relativeX","relativeY","some","path","isPointInPath","_resource$fragmentSel","w","h","_this4","_this$props4","lists","concat","l","targetId","_this$props5","selectAnnotation","deselectAnnotation","_this$props6","getMaxZoom","canvasIds","includes","offsetByCanvas","hidden","toContext","_this$props7","annotationsToContext","search","createPortal","createElement","left","top","Fragment","defaultProps","mapDispatchToProps","withTranslation","state","window","forceDrawAnnotations","content","withPlugins","OSDReferences","refs","set","_construct","Parent","args","Class","Function","OpenSeadragonViewer","apiRef","onViewportChange","zoomToWorld","osdUpdating","osdConfig","t","setState","innerTracker","moveHandler","prevState","viewerConfig","panTo","zoomTo","setRotation","flip","setFlip","addAllImageSources","infoResponsesMatch","infoResponses","nonTiledImagedMatch","nonTiledImages","layers","centerSpringX","centerSpringY","zoomSpring","refreshTileProperties","close","canvasesChanged","removeAllHandlers","raiseEvent","updateViewport","round","zoomAfterAdd","Promise","all","infoResponse","addTileSource","image","addNonTiledImage","then","contentResource","type","getProperty","format","startsWith","resolve","reject","addSimpleImage","error","fitBounds","Rect","contentResourceToWorldCoordinates","layerIndexOfImageResource","opacity","layerOpacityOfImageResource","success","url","tileSource","json","addTiledImage","items","getItemCount","item","newIndex","setItemIndex","setOpacity","immediately","prevInfoResponses","tokenServiceId","prevNonTiledImages","worldBounds","children","classes","label","enhancedChildren","Children","child","cloneElement","className","osdContainer","PluginHook","assign","withStyles","flex","imageServiceIds","canvases","c","isFetching","canvasId","compareAscending","other","orders","objCriteria","criteria","othCriteria","ordersLength","arrayFilter","baseRest","baseXor","isArrayLikeObject","xor","arrayMap","baseGet","baseIteratee","baseMap","baseSortBy","baseUnary","compareMultiple","identity","collection","iteratees","baseEach","isArrayLike","eq","isIndex","isObject","baseOrderBy","isIterateeCall","sortBy","isSymbol","valIsDefined","valIsNull","valIsReflexive","valIsSymbol","othIsDefined","othIsNull","othIsReflexive","othIsSymbol"],"mappings":"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","file":"12-29837e0da5c47580f21f.js","sourcesContent":["/**\n * The base implementation of `_.sortBy` which uses `comparer` to define the\n * sort order of `array` and replaces criteria objects with their corresponding\n * values.\n *\n * @private\n * @param {Array} array The array to sort.\n * @param {Function} comparer The function to define sort order.\n * @returns {Array} Returns `array`.\n */\nfunction baseSortBy(array, comparer) {\n  var length = array.length;\n\n  array.sort(comparer);\n  while (length--) {\n    array[length] = array[length].value;\n  }\n  return array;\n}\n\nmodule.exports = baseSortBy;\n","var baseDifference = require('./_baseDifference'),\n    baseFlatten = require('./_baseFlatten'),\n    baseUniq = require('./_baseUniq');\n\n/**\n * The base implementation of methods like `_.xor`, without support for\n * iteratee shorthands, that accepts an array of arrays to inspect.\n *\n * @private\n * @param {Array} arrays The arrays to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of values.\n */\nfunction baseXor(arrays, iteratee, comparator) {\n  var length = arrays.length;\n  if (length < 2) {\n    return length ? baseUniq(arrays[0]) : [];\n  }\n  var index = -1,\n      result = Array(length);\n\n  while (++index < length) {\n    var array = arrays[index],\n        othIndex = -1;\n\n    while (++othIndex < length) {\n      if (othIndex != index) {\n        result[index] = baseDifference(result[index] || array, arrays[othIndex], iteratee, comparator);\n      }\n    }\n  }\n  return baseUniq(baseFlatten(result, 1), iteratee, comparator);\n}\n\nmodule.exports = baseXor;\n","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nimport OpenSeadragon from 'openseadragon';\n/**\n * OpenSeadragonCanvasOverlay - adapted from https://github.com/altert/OpenSeadragonCanvasOverlay\n * used rather than an \"onRedraw\" function we tap into our own method. Existing\n * repository is not published as an npm package.\n * Code ported from https://github.com/altert/OpenSeadragonCanvasOverlay\n * carries a BSD 3-Clause license originally authored by @altert from\n * https://github.com/altert/OpenseadragonFabricjsOverlay\n */\n\nvar OpenSeadragonCanvasOverlay = /*#__PURE__*/function () {\n  /**\n   * constructor - sets up the Canvas overlay container\n   */\n  function OpenSeadragonCanvasOverlay(viewer, ref) {\n    _classCallCheck(this, OpenSeadragonCanvasOverlay);\n\n    this.viewer = viewer;\n    this.ref = ref;\n    this.containerWidth = 0;\n    this.containerHeight = 0;\n    this.imgAspectRatio = 1;\n  }\n  /** */\n\n\n  _createClass(OpenSeadragonCanvasOverlay, [{\n    key: \"clear\",\n\n    /** */\n    value: function clear() {\n      this.context2d.clearRect(0, 0, this.containerWidth, this.containerHeight);\n    }\n    /**\n     * resize - resizes the added Canvas overlay.\n     */\n\n  }, {\n    key: \"resize\",\n    value: function resize() {\n      if (this.containerWidth !== this.viewer.container.clientWidth) {\n        this.containerWidth = this.viewer.container.clientWidth;\n        this.canvasDiv.setAttribute('width', this.containerWidth);\n        this.canvas.setAttribute('width', this.containerWidth);\n      }\n\n      if (this.containerHeight !== this.viewer.container.clientHeight) {\n        this.containerHeight = this.viewer.container.clientHeight;\n        this.canvasDiv.setAttribute('height', this.containerHeight);\n        this.canvas.setAttribute('height', this.containerHeight);\n      }\n\n      this.viewportOrigin = new OpenSeadragon.Point(0, 0);\n      var boundsRect = this.viewer.viewport.getBoundsNoRotate(true);\n      this.viewportOrigin.x = boundsRect.x;\n      this.viewportOrigin.y = boundsRect.y * this.imgAspectRatio;\n      this.viewportWidth = boundsRect.width;\n      this.viewportHeight = boundsRect.height * this.imgAspectRatio;\n      var image1 = this.viewer.world.getItemAt(0);\n      if (!image1) return;\n      this.imgWidth = image1.source.dimensions.x;\n      this.imgHeight = image1.source.dimensions.y;\n      this.imgAspectRatio = this.imgWidth / this.imgHeight;\n    }\n    /**\n     * canvasUpdate - sets up the dimensions for the canvas update to mimick image\n     * 0 dimensions. Then call provided update function.\n     * @param {Function} update\n     */\n\n  }, {\n    key: \"canvasUpdate\",\n    value: function canvasUpdate(update) {\n      var viewportZoom = this.viewer.viewport.getZoom(true);\n      var image1 = this.viewer.world.getItemAt(0);\n      if (!image1) return;\n      var zoom = image1.viewportToImageZoom(viewportZoom);\n      var x = (this.viewportOrigin.x / this.imgWidth - this.viewportOrigin.x) / this.viewportWidth * this.containerWidth;\n      var y = (this.viewportOrigin.y / this.imgHeight - this.viewportOrigin.y) / this.viewportHeight * this.containerHeight;\n      if (this.clearBeforeRedraw) this.clear();\n      this.context2d.translate(x, y);\n      this.context2d.scale(zoom, zoom);\n      var center = this.viewer.viewport.getCenter();\n      var flip = this.viewer.viewport.getFlip();\n\n      if (flip) {\n        this.context2d.translate(center.x * 2, 0);\n        this.context2d.scale(-1, 1);\n      }\n\n      var rotation = this.viewer.viewport.getRotation();\n\n      if (rotation !== 0) {\n        this.context2d.translate(center.x, center.y);\n        this.context2d.rotate(rotation * Math.PI / 180);\n        this.context2d.translate(-1 * center.x, -1 * center.y);\n      }\n\n      update();\n      this.context2d.setTransform(1, 0, 0, 1, 0, 0);\n    }\n  }, {\n    key: \"canvas\",\n    get: function get() {\n      return this.canvasDiv.firstElementChild;\n    }\n    /** */\n\n  }, {\n    key: \"canvasDiv\",\n    get: function get() {\n      return this.ref.current;\n    }\n    /** */\n\n  }, {\n    key: \"context2d\",\n    get: function get() {\n      return this.canvas.getContext('2d');\n    }\n  }]);\n\n  return OpenSeadragonCanvasOverlay;\n}();\n\nexport { OpenSeadragonCanvasOverlay as default };","function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n/**\n * CanvasAnnotationDisplay - class used to display a SVG and fragment based\n * annotations.\n */\n\n\nvar CanvasAnnotationDisplay = /*#__PURE__*/function () {\n  /** */\n  function CanvasAnnotationDisplay(_ref) {\n    var resource = _ref.resource,\n        palette = _ref.palette,\n        zoomRatio = _ref.zoomRatio,\n        offset = _ref.offset,\n        selected = _ref.selected,\n        hovered = _ref.hovered;\n\n    _classCallCheck(this, CanvasAnnotationDisplay);\n\n    this.resource = resource;\n    this.palette = palette;\n    this.zoomRatio = zoomRatio;\n    this.offset = offset;\n    this.selected = selected;\n    this.hovered = hovered;\n  }\n  /** */\n\n\n  _createClass(CanvasAnnotationDisplay, [{\n    key: \"toContext\",\n    value: function toContext(context) {\n      this.context = context;\n\n      if (this.resource.svgSelector) {\n        this.svgContext();\n      } else {\n        this.fragmentContext();\n      }\n    }\n    /** */\n\n  }, {\n    key: \"svgContext\",\n\n    /** */\n    value: function svgContext() {\n      var _this = this;\n\n      var currentPalette;\n\n      if (this.hovered) {\n        currentPalette = this.palette.hovered;\n      } else if (this.selected) {\n        currentPalette = this.palette.selected;\n      } else {\n        currentPalette = this.palette[\"default\"];\n      }\n\n      if (currentPalette.globalAlpha === 0) return;\n\n      _toConsumableArray(this.svgPaths).forEach(function (element) {\n        /**\n         *  Note: Path2D is not supported in IE11.\n         *  TODO: Support multi canvas offset\n         *  One example: https://developer.mozilla.org/en-US/docs/Web/API/Path2D/addPath\n         */\n        _this.context.save();\n\n        _this.context.translate(_this.offset.x, _this.offset.y);\n\n        var p = new Path2D(element.attributes.d.nodeValue); // Setup styling from SVG -> Canvas\n\n        _this.context.strokeStyle = _this.color;\n\n        if (element.attributes['stroke-dasharray']) {\n          _this.context.setLineDash(element.attributes['stroke-dasharray'].nodeValue.split(','));\n        }\n\n        var svgToCanvasMap = {\n          fill: 'fillStyle',\n          stroke: 'strokeStyle',\n          'stroke-dashoffset': 'lineDashOffset',\n          'stroke-linecap': 'lineCap',\n          'stroke-linejoin': 'lineJoin',\n          'stroke-miterlimit': 'miterlimit',\n          'stroke-width': 'lineWidth'\n        };\n        Object.keys(svgToCanvasMap).forEach(function (key) {\n          if (element.attributes[key]) {\n            _this.context[svgToCanvasMap[key]] = element.attributes[key].nodeValue;\n          }\n        }); // Resize the stroke based off of the zoomRatio (currentZoom / maxZoom)\n\n        _this.context.lineWidth /= _this.zoomRatio; // Reset the color if it is selected or hovered on\n\n        if (_this.selected || _this.hovered) {\n          _this.context.strokeStyle = currentPalette.strokeStyle || currentPalette.fillStyle;\n        }\n\n        if (element.attributes['stroke-opacity']) {\n          _this.context.globalAlpha = currentPalette.globalAlpha * element.attributes['stroke-opacity'].nodeValue;\n        } else {\n          _this.context.globalAlpha = currentPalette.globalAlpha;\n        }\n\n        _this.context.stroke(p); // Wait to set the fill, so we can adjust the globalAlpha value if we need to\n\n\n        if (element.attributes.fill && element.attributes.fill.nodeValue !== 'none') {\n          if (element.attributes['fill-opacity']) {\n            _this.context.globalAlpha = currentPalette.globalAlpha * element.attributes['fill-opacity'].nodeValue;\n          } else {\n            _this.context.globalAlpha = currentPalette.globalAlpha;\n          }\n\n          _this.context.fill(p);\n        }\n\n        _this.context.restore();\n      });\n    }\n    /** */\n\n  }, {\n    key: \"fragmentContext\",\n    value: function fragmentContext() {\n      var _this2 = this;\n\n      var fragment = this.resource.fragmentSelector;\n      fragment[0] += this.offset.x;\n      fragment[1] += this.offset.y;\n      var currentPalette;\n\n      if (this.selected) {\n        currentPalette = this.palette.selected;\n      } else if (this.hovered) {\n        currentPalette = this.palette.hovered;\n      } else {\n        currentPalette = this.palette[\"default\"];\n      }\n\n      this.context.save();\n      Object.keys(currentPalette).forEach(function (key) {\n        _this2.context[key] = currentPalette[key];\n      });\n      if (currentPalette.globalAlpha === 0) return;\n\n      if (currentPalette.fillStyle) {\n        var _this$context;\n\n        (_this$context = this.context).fillRect.apply(_this$context, _toConsumableArray(fragment));\n      } else {\n        var _this$context2;\n\n        this.context.lineWidth = 1 / this.zoomRatio;\n\n        (_this$context2 = this.context).strokeRect.apply(_this$context2, _toConsumableArray(fragment));\n      }\n\n      this.context.restore();\n    }\n    /** */\n\n  }, {\n    key: \"svgString\",\n    get: function get() {\n      return this.resource.svgSelector.value;\n    }\n  }, {\n    key: \"svgPaths\",\n    get: function get() {\n      var parser = new DOMParser();\n      var xmlDoc = parser.parseFromString(this.svgString, 'text/xml');\n      return xmlDoc.getElementsByTagName('path');\n    }\n  }]);\n\n  return CanvasAnnotationDisplay;\n}();\n\nexport { CanvasAnnotationDisplay as default };","function ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nimport React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport isEqual from 'lodash/isEqual';\nimport debounce from 'lodash/debounce';\nimport flatten from 'lodash/flatten';\nimport sortBy from 'lodash/sortBy';\nimport xor from 'lodash/xor';\nimport OpenSeadragonCanvasOverlay from '../lib/OpenSeadragonCanvasOverlay';\nimport CanvasWorld from '../lib/CanvasWorld';\nimport CanvasAnnotationDisplay from '../lib/CanvasAnnotationDisplay';\n/**\n * Represents a OpenSeadragonViewer in the mirador workspace. Responsible for mounting\n * and rendering OSD.\n */\n\nexport var AnnotationsOverlay = /*#__PURE__*/function (_Component) {\n  _inherits(AnnotationsOverlay, _Component);\n\n  var _super = _createSuper(AnnotationsOverlay);\n\n  _createClass(AnnotationsOverlay, null, [{\n    key: \"annotationsMatch\",\n\n    /**\n     * annotationsMatch - compares previous annotations to current to determine\n     * whether to add a new updateCanvas method to draw annotations\n     * @param  {Array} currentAnnotations\n     * @param  {Array} prevAnnotations\n     * @return {Boolean}\n     */\n    value: function annotationsMatch(currentAnnotations, prevAnnotations) {\n      if (!currentAnnotations && !prevAnnotations) return true;\n      if (currentAnnotations && !prevAnnotations || !currentAnnotations && prevAnnotations) return false;\n      if (currentAnnotations.length === 0 && prevAnnotations.length === 0) return true;\n      if (currentAnnotations.length !== prevAnnotations.length) return false;\n      return currentAnnotations.every(function (annotation, index) {\n        var newIds = annotation.resources.map(function (r) {\n          return r.id;\n        });\n        var prevIds = prevAnnotations[index].resources.map(function (r) {\n          return r.id;\n        });\n        if (newIds.length === 0 && prevIds.length === 0) return true;\n        if (newIds.length !== prevIds.length) return false;\n\n        if (annotation.id === prevAnnotations[index].id && isEqual(newIds, prevIds)) {\n          return true;\n        }\n\n        return false;\n      });\n    }\n    /**\n     * @param {Object} props\n     */\n\n  }]);\n\n  function AnnotationsOverlay(props) {\n    var _this;\n\n    _classCallCheck(this, AnnotationsOverlay);\n\n    _this = _super.call(this, props);\n    _this.ref = /*#__PURE__*/React.createRef();\n    _this.osdCanvasOverlay = null; // An initial value for the updateCanvas method\n\n    _this.updateCanvas = function () {};\n\n    _this.onUpdateViewport = _this.onUpdateViewport.bind(_assertThisInitialized(_this));\n    _this.onCanvasClick = _this.onCanvasClick.bind(_assertThisInitialized(_this));\n    _this.onCanvasMouseMove = debounce(_this.onCanvasMouseMove.bind(_assertThisInitialized(_this)), 10);\n    _this.onCanvasExit = _this.onCanvasExit.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n  /**\n   * React lifecycle event\n   */\n\n\n  _createClass(AnnotationsOverlay, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initializeViewer();\n    }\n    /**\n     * When the tileSources change, make sure to close the OSD viewer.\n     * When the annotations change, reset the updateCanvas method to make sure\n     * they are added.\n     * When the viewport state changes, pan or zoom the OSD viewer as appropriate\n     */\n\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props = this.props,\n          drawAnnotations = _this$props.drawAnnotations,\n          drawSearchAnnotations = _this$props.drawSearchAnnotations,\n          annotations = _this$props.annotations,\n          searchAnnotations = _this$props.searchAnnotations,\n          hoveredAnnotationIds = _this$props.hoveredAnnotationIds,\n          selectedAnnotationId = _this$props.selectedAnnotationId,\n          highlightAllAnnotations = _this$props.highlightAllAnnotations,\n          viewer = _this$props.viewer;\n      this.initializeViewer();\n      var annotationsUpdated = !AnnotationsOverlay.annotationsMatch(annotations, prevProps.annotations);\n      var searchAnnotationsUpdated = !AnnotationsOverlay.annotationsMatch(searchAnnotations, prevProps.searchAnnotations);\n      var hoveredAnnotationsUpdated = xor(hoveredAnnotationIds, prevProps.hoveredAnnotationIds).length > 0;\n\n      if (this.osdCanvasOverlay && hoveredAnnotationsUpdated) {\n        if (hoveredAnnotationIds.length > 0) {\n          this.osdCanvasOverlay.canvasDiv.style.cursor = 'pointer';\n        } else {\n          this.osdCanvasOverlay.canvasDiv.style.cursor = '';\n        }\n      }\n\n      var selectedAnnotationsUpdated = selectedAnnotationId !== prevProps.selectedAnnotationId;\n      var redrawAnnotations = drawAnnotations !== prevProps.drawAnnotations || drawSearchAnnotations !== prevProps.drawSearchAnnotations || highlightAllAnnotations !== prevProps.highlightAllAnnotations;\n\n      if (searchAnnotationsUpdated || annotationsUpdated || selectedAnnotationsUpdated || hoveredAnnotationsUpdated || redrawAnnotations) {\n        this.updateCanvas = this.canvasUpdateCallback();\n        viewer.forceRedraw();\n      }\n    }\n    /**\n     */\n\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var viewer = this.props.viewer;\n      viewer.removeHandler('canvas-click', this.onCanvasClick);\n      viewer.removeHandler('canvas-exit', this.onCanvasExit);\n      viewer.removeHandler('update-viewport', this.onUpdateViewport);\n      viewer.removeHandler('mouse-move', this.onCanvasMouseMove);\n    }\n    /** */\n\n  }, {\n    key: \"onCanvasClick\",\n    value: function onCanvasClick(event) {\n      var _this2 = this;\n\n      var canvasWorld = this.props.canvasWorld;\n      var webPosition = event.position,\n          viewport = event.eventSource.viewport;\n      var point = viewport.pointFromPixel(webPosition);\n      var canvas = canvasWorld.canvasAtPoint(point);\n      if (!canvas) return;\n\n      var _canvasWorld$canvasTo = canvasWorld.canvasToWorldCoordinates(canvas.id),\n          _canvasWorld$canvasTo2 = _slicedToArray(_canvasWorld$canvasTo, 4),\n          _canvasX = _canvasWorld$canvasTo2[0],\n          _canvasY = _canvasWorld$canvasTo2[1],\n          canvasWidth = _canvasWorld$canvasTo2[2],\n          canvasHeight // eslint-disable-line no-unused-vars\n      = _canvasWorld$canvasTo2[3]; // get all the annotations that contain the click\n\n\n      var annos = this.annotationsAtPoint(canvas, point);\n\n      if (annos.length > 0) {\n        event.preventDefaultAction = true; // eslint-disable-line no-param-reassign\n      }\n\n      if (annos.length === 1) {\n        this.toggleAnnotation(annos[0].id);\n      } else if (annos.length > 0) {\n        /**\n         * Try to find the \"right\" annotation to select after a click.\n         *\n         * This is perhaps a naive method, but seems to deal with rectangles and SVG shapes:\n         *\n         * - figure out how many points around a circle are inside the annotation shape\n         * - if there's a shape with the fewest interior points, it's probably the one\n         *       with the closest boundary?\n         * - if there's a tie, make the circle bigger and try again.\n         */\n        var annosWithClickScore = function annosWithClickScore(radius) {\n          var degreesToRadians = Math.PI / 180;\n          return function (anno) {\n            var score = 0;\n\n            for (var degrees = 0; degrees < 360; degrees += 1) {\n              var x = Math.cos(degrees * degreesToRadians) * radius + point.x;\n              var y = Math.sin(degrees * degreesToRadians) * radius + point.y;\n              if (_this2.isAnnotationAtPoint(anno, canvas, {\n                x: x,\n                y: y\n              })) score += 1;\n            }\n\n            return {\n              anno: anno,\n              score: score\n            };\n          };\n        };\n\n        var annosWithScore = [];\n        var radius = 1;\n        annosWithScore = sortBy(annos.map(annosWithClickScore(radius)), 'score');\n\n        while (radius < Math.max(canvasWidth, canvasHeight) && annosWithScore[0].score === annosWithScore[1].score) {\n          radius *= 2;\n          annosWithScore = sortBy(annos.map(annosWithClickScore(radius)), 'score');\n        }\n\n        this.toggleAnnotation(annosWithScore[0].anno.id);\n      }\n    }\n    /** */\n\n  }, {\n    key: \"onCanvasMouseMove\",\n    value: function onCanvasMouseMove(event) {\n      var _this$props2 = this.props,\n          annotations = _this$props2.annotations,\n          canvasWorld = _this$props2.canvasWorld,\n          hoverAnnotation = _this$props2.hoverAnnotation,\n          hoveredAnnotationIds = _this$props2.hoveredAnnotationIds,\n          searchAnnotations = _this$props2.searchAnnotations,\n          viewer = _this$props2.viewer,\n          windowId = _this$props2.windowId;\n      if (annotations.length === 0 && searchAnnotations.length === 0) return;\n      var webPosition = event.position;\n      var point = viewer.viewport.pointFromPixel(webPosition);\n      var canvas = canvasWorld.canvasAtPoint(point);\n\n      if (!canvas) {\n        hoverAnnotation(windowId, []);\n        return;\n      }\n\n      var annos = this.annotationsAtPoint(canvas, point);\n\n      if (xor(hoveredAnnotationIds, annos.map(function (a) {\n        return a.id;\n      })).length > 0) {\n        hoverAnnotation(windowId, annos.map(function (a) {\n          return a.id;\n        }));\n      }\n    }\n    /** If the cursor leaves the canvas, wipe out highlights */\n\n  }, {\n    key: \"onCanvasExit\",\n    value: function onCanvasExit(event) {\n      var _this$props3 = this.props,\n          hoverAnnotation = _this$props3.hoverAnnotation,\n          windowId = _this$props3.windowId; // a move event may be queued up by the debouncer\n\n      this.onCanvasMouseMove.cancel();\n      hoverAnnotation(windowId, []);\n    }\n    /**\n     * onUpdateViewport - fires during OpenSeadragon render method.\n     */\n\n  }, {\n    key: \"onUpdateViewport\",\n    value: function onUpdateViewport(event) {\n      this.updateCanvas();\n    }\n    /** @private */\n\n  }, {\n    key: \"initializeViewer\",\n    value: function initializeViewer() {\n      var viewer = this.props.viewer;\n      if (!viewer) return;\n      if (this.osdCanvasOverlay) return;\n      this.osdCanvasOverlay = new OpenSeadragonCanvasOverlay(viewer, this.ref);\n      viewer.addHandler('canvas-click', this.onCanvasClick);\n      viewer.addHandler('canvas-exit', this.onCanvasExit);\n      viewer.addHandler('update-viewport', this.onUpdateViewport);\n      viewer.addHandler('mouse-move', this.onCanvasMouseMove);\n      this.updateCanvas = this.canvasUpdateCallback();\n    }\n    /** */\n\n  }, {\n    key: \"canvasUpdateCallback\",\n    value: function canvasUpdateCallback() {\n      var _this3 = this;\n\n      return function () {\n        _this3.osdCanvasOverlay.clear();\n\n        _this3.osdCanvasOverlay.resize();\n\n        _this3.osdCanvasOverlay.canvasUpdate(_this3.renderAnnotations.bind(_this3));\n      };\n    }\n    /** @private */\n\n  }, {\n    key: \"isAnnotationAtPoint\",\n    value: function isAnnotationAtPoint(resource, canvas, point) {\n      var canvasWorld = this.props.canvasWorld;\n\n      var _canvasWorld$canvasTo3 = canvasWorld.canvasToWorldCoordinates(canvas.id),\n          _canvasWorld$canvasTo4 = _slicedToArray(_canvasWorld$canvasTo3, 2),\n          canvasX = _canvasWorld$canvasTo4[0],\n          canvasY = _canvasWorld$canvasTo4[1];\n\n      var relativeX = point.x - canvasX;\n      var relativeY = point.y - canvasY;\n\n      if (resource.svgSelector) {\n        var context = this.osdCanvasOverlay.context2d;\n\n        var _CanvasAnnotationDisp = new CanvasAnnotationDisplay({\n          resource: resource\n        }),\n            svgPaths = _CanvasAnnotationDisp.svgPaths;\n\n        return _toConsumableArray(svgPaths).some(function (path) {\n          return context.isPointInPath(new Path2D(path.attributes.d.nodeValue), relativeX, relativeY);\n        });\n      }\n\n      if (resource.fragmentSelector) {\n        var _resource$fragmentSel = _slicedToArray(resource.fragmentSelector, 4),\n            x = _resource$fragmentSel[0],\n            y = _resource$fragmentSel[1],\n            w = _resource$fragmentSel[2],\n            h = _resource$fragmentSel[3];\n\n        return x <= relativeX && relativeX <= x + w && y <= relativeY && relativeY <= y + h;\n      }\n\n      return false;\n    }\n    /** @private */\n\n  }, {\n    key: \"annotationsAtPoint\",\n    value: function annotationsAtPoint(canvas, point) {\n      var _this4 = this;\n\n      var _this$props4 = this.props,\n          annotations = _this$props4.annotations,\n          searchAnnotations = _this$props4.searchAnnotations;\n      var lists = [].concat(_toConsumableArray(annotations), _toConsumableArray(searchAnnotations));\n      var annos = flatten(lists.map(function (l) {\n        return l.resources;\n      })).filter(function (resource) {\n        if (canvas.id !== resource.targetId) return false;\n        return _this4.isAnnotationAtPoint(resource, canvas, point);\n      });\n      return annos;\n    }\n    /** */\n\n  }, {\n    key: \"toggleAnnotation\",\n    value: function toggleAnnotation(id) {\n      var _this$props5 = this.props,\n          selectedAnnotationId = _this$props5.selectedAnnotationId,\n          selectAnnotation = _this$props5.selectAnnotation,\n          deselectAnnotation = _this$props5.deselectAnnotation,\n          windowId = _this$props5.windowId;\n\n      if (selectedAnnotationId === id) {\n        deselectAnnotation(windowId, id);\n      } else {\n        selectAnnotation(windowId, id);\n      }\n    }\n    /**\n     * annotationsToContext - converts anontations to a canvas context\n     */\n\n  }, {\n    key: \"annotationsToContext\",\n    value: function annotationsToContext(annotations, palette) {\n      var _this$props6 = this.props,\n          highlightAllAnnotations = _this$props6.highlightAllAnnotations,\n          hoveredAnnotationIds = _this$props6.hoveredAnnotationIds,\n          selectedAnnotationId = _this$props6.selectedAnnotationId,\n          canvasWorld = _this$props6.canvasWorld,\n          viewer = _this$props6.viewer;\n      var context = this.osdCanvasOverlay.context2d;\n      var zoomRatio = viewer.viewport.getZoom(true) / viewer.viewport.getMaxZoom();\n      annotations.forEach(function (annotation) {\n        annotation.resources.forEach(function (resource) {\n          if (!canvasWorld.canvasIds.includes(resource.targetId)) return;\n          var offset = canvasWorld.offsetByCanvas(resource.targetId);\n          var canvasAnnotationDisplay = new CanvasAnnotationDisplay({\n            hovered: hoveredAnnotationIds.includes(resource.id),\n            offset: offset,\n            palette: _objectSpread(_objectSpread({}, palette), {}, {\n              \"default\": _objectSpread(_objectSpread({}, palette[\"default\"]), !highlightAllAnnotations && palette.hidden)\n            }),\n            resource: resource,\n            selected: selectedAnnotationId === resource.id,\n            zoomRatio: zoomRatio\n          });\n          canvasAnnotationDisplay.toContext(context);\n        });\n      });\n    }\n    /** */\n\n  }, {\n    key: \"renderAnnotations\",\n    value: function renderAnnotations() {\n      var _this$props7 = this.props,\n          annotations = _this$props7.annotations,\n          drawAnnotations = _this$props7.drawAnnotations,\n          drawSearchAnnotations = _this$props7.drawSearchAnnotations,\n          searchAnnotations = _this$props7.searchAnnotations,\n          palette = _this$props7.palette;\n\n      if (drawSearchAnnotations) {\n        this.annotationsToContext(searchAnnotations, palette.search);\n      }\n\n      if (drawAnnotations) {\n        this.annotationsToContext(annotations, palette.annotations);\n      }\n    }\n    /**\n     * Renders things\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var viewer = this.props.viewer;\n      if (!viewer) return /*#__PURE__*/React.createElement(React.Fragment, null);\n      return /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/React.createElement(\"div\", {\n        ref: this.ref,\n        style: {\n          height: '100%',\n          left: 0,\n          position: 'absolute',\n          top: 0,\n          width: '100%'\n        }\n      }, /*#__PURE__*/React.createElement(\"canvas\", null)), viewer.canvas);\n    }\n  }]);\n\n  return AnnotationsOverlay;\n}(Component);\nAnnotationsOverlay.defaultProps = {\n  annotations: [],\n  deselectAnnotation: function deselectAnnotation() {},\n  drawAnnotations: true,\n  drawSearchAnnotations: true,\n  highlightAllAnnotations: false,\n  hoverAnnotation: function hoverAnnotation() {},\n  hoveredAnnotationIds: [],\n  palette: {},\n  searchAnnotations: [],\n  selectAnnotation: function selectAnnotation() {},\n  selectedAnnotationId: undefined,\n  viewer: null\n};","import { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withTranslation } from 'react-i18next';\nimport { withPlugins } from '../extend/withPlugins';\nimport { AnnotationsOverlay } from '../components/AnnotationsOverlay';\nimport * as actions from '../state/actions';\nimport { getWindow, getSearchAnnotationsForWindow, getCompanionWindowsForContent, getTheme, getConfig, getPresentAnnotationsOnSelectedCanvases, getSelectedAnnotationId, getCurrentCanvasWorld } from '../state/selectors';\n/**\n * mapStateToProps - used to hook up connect to action creators\n * @memberof Window\n * @private\n */\n\nvar mapStateToProps = function mapStateToProps(state, _ref) {\n  var windowId = _ref.windowId;\n  return {\n    annotations: getPresentAnnotationsOnSelectedCanvases(state, {\n      windowId: windowId\n    }),\n    canvasWorld: getCurrentCanvasWorld(state, {\n      windowId: windowId\n    }),\n    drawAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'annotations',\n      windowId: windowId\n    }).length > 0,\n    drawSearchAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'search',\n      windowId: windowId\n    }).length > 0,\n    highlightAllAnnotations: getWindow(state, {\n      windowId: windowId\n    }).highlightAllAnnotations,\n    hoveredAnnotationIds: getWindow(state, {\n      windowId: windowId\n    }).hoveredAnnotationIds,\n    palette: getTheme(state).palette,\n    searchAnnotations: getSearchAnnotationsForWindow(state, {\n      windowId: windowId\n    }),\n    selectedAnnotationId: getSelectedAnnotationId(state, {\n      windowId: windowId\n    })\n  };\n};\n/**\n * mapDispatchToProps - used to hook up connect to action creators\n * @memberof ManifestListItem\n * @private\n */\n\n\nvar mapDispatchToProps = {\n  deselectAnnotation: actions.deselectAnnotation,\n  hoverAnnotation: actions.hoverAnnotation,\n  selectAnnotation: actions.selectAnnotation\n};\nvar enhance = compose(withTranslation(), connect(mapStateToProps, mapDispatchToProps), withPlugins('AnnotationsOverlay'));\nexport default enhance(AnnotationsOverlay);","export var OSDReferences = {\n  /** */\n  get: function get(windowId) {\n    return this.refs[windowId];\n  },\n  refs: {},\n\n  /** */\n  set: function set(windowId, ref) {\n    this.refs[windowId] = ref;\n  }\n};","function _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nimport React, { Component } from 'react';\nimport debounce from 'lodash/debounce';\nimport isEqual from 'lodash/isEqual';\nimport OpenSeadragon from 'openseadragon';\nimport classNames from 'classnames';\nimport ns from '../config/css-ns';\nimport AnnotationsOverlay from '../containers/AnnotationsOverlay';\nimport CanvasWorld from '../lib/CanvasWorld';\nimport { PluginHook } from './PluginHook';\nimport { OSDReferences } from '../plugins/OSDReferences';\n/**\n * Represents a OpenSeadragonViewer in the mirador workspace. Responsible for mounting\n * and rendering OSD.\n */\n\nexport var OpenSeadragonViewer = /*#__PURE__*/function (_Component) {\n  _inherits(OpenSeadragonViewer, _Component);\n\n  var _super = _createSuper(OpenSeadragonViewer);\n  /**\n   * @param {Object} props\n   */\n\n\n  function OpenSeadragonViewer(props) {\n    var _this;\n\n    _classCallCheck(this, OpenSeadragonViewer);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      viewer: undefined\n    };\n    _this.ref = /*#__PURE__*/React.createRef();\n    _this.apiRef = /*#__PURE__*/React.createRef();\n    OSDReferences.set(props.windowId, _this.apiRef);\n    _this.onCanvasMouseMove = debounce(_this.onCanvasMouseMove.bind(_assertThisInitialized(_this)), 10);\n    _this.onViewportChange = _this.onViewportChange.bind(_assertThisInitialized(_this));\n    _this.zoomToWorld = _this.zoomToWorld.bind(_assertThisInitialized(_this));\n    _this.osdUpdating = false;\n    return _this;\n  }\n  /**\n   * React lifecycle event\n   */\n\n\n  _createClass(OpenSeadragonViewer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          osdConfig = _this$props.osdConfig,\n          t = _this$props.t,\n          windowId = _this$props.windowId;\n\n      if (!this.ref.current) {\n        return;\n      }\n\n      var viewer = new OpenSeadragon(_objectSpread({\n        id: this.ref.current.id\n      }, osdConfig));\n      var canvas = viewer.canvas && viewer.canvas.firstElementChild;\n\n      if (canvas) {\n        canvas.setAttribute('role', 'img');\n        canvas.setAttribute('aria-label', t('digitizedView'));\n        canvas.setAttribute('aria-describedby', \"\".concat(windowId, \"-osd\"));\n      }\n\n      this.apiRef.current = viewer;\n      this.setState({\n        viewer: viewer\n      }); // Set a flag when OSD starts animating (so that viewer updates are not used)\n\n      viewer.addHandler('animation-start', function () {\n        _this2.osdUpdating = true;\n      });\n      viewer.addHandler('animation-finish', this.onViewportChange);\n      viewer.addHandler('animation-finish', function () {\n        _this2.osdUpdating = false;\n      });\n\n      if (viewer.innerTracker) {\n        viewer.innerTracker.moveHandler = this.onCanvasMouseMove;\n      }\n    }\n    /**\n     * When the tileSources change, make sure to close the OSD viewer.\n     * When the annotations change, reset the updateCanvas method to make sure\n     * they are added.\n     * When the viewport state changes, pan or zoom the OSD viewer as appropriate\n     */\n\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this$props2 = this.props,\n          viewerConfig = _this$props2.viewerConfig,\n          canvasWorld = _this$props2.canvasWorld;\n      var viewer = this.state.viewer;\n      this.apiRef.current = viewer;\n\n      if (prevState.viewer === undefined) {\n        if (viewerConfig) {\n          viewer.viewport.panTo(viewerConfig, true);\n          viewer.viewport.zoomTo(viewerConfig.zoom, viewerConfig, true);\n          viewerConfig.degrees !== undefined && viewer.viewport.setRotation(viewerConfig.degrees);\n          viewerConfig.flip !== undefined && viewer.viewport.setFlip(viewerConfig.flip);\n        }\n\n        this.addAllImageSources(!viewerConfig);\n        return;\n      }\n\n      if (!this.infoResponsesMatch(prevProps.infoResponses) || !this.nonTiledImagedMatch(prevProps.nonTiledImages)) {\n        viewer.close();\n        var canvasesChanged = !isEqual(canvasWorld.canvasIds, prevProps.canvasWorld.canvasIds);\n        this.addAllImageSources(canvasesChanged || !viewerConfig);\n      } else if (!isEqual(canvasWorld.layers, prevProps.canvasWorld.layers)) {\n        this.refreshTileProperties();\n      } else if (viewerConfig && !this.osdUpdating) {\n        var viewport = viewer.viewport;\n\n        if (viewerConfig.x !== viewport.centerSpringX.target.value || viewerConfig.y !== viewport.centerSpringY.target.value) {\n          viewport.panTo(viewerConfig, false);\n        }\n\n        if (viewerConfig.zoom !== viewport.zoomSpring.target.value) {\n          viewport.zoomTo(viewerConfig.zoom, viewerConfig, false);\n        }\n\n        if (viewerConfig.rotation !== viewport.getRotation()) {\n          viewport.setRotation(viewerConfig.rotation);\n        }\n\n        if (viewerConfig.flip !== viewport.getFlip()) {\n          viewport.setFlip(viewerConfig.flip);\n        }\n      }\n    }\n    /**\n     */\n\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var viewer = this.state.viewer;\n\n      if (viewer.innerTracker && viewer.innerTracker.moveHandler === this.onCanvasMouseMove) {\n        viewer.innerTracker.moveHandler = null;\n      }\n\n      viewer.removeAllHandlers();\n      this.apiRef.current = undefined;\n    }\n    /** Shim to provide a mouse-move event coming from the viewer */\n\n  }, {\n    key: \"onCanvasMouseMove\",\n    value: function onCanvasMouseMove(event) {\n      var viewer = this.state.viewer;\n      viewer.raiseEvent('mouse-move', event);\n    }\n    /**\n     * Forward OSD state to redux\n     */\n\n  }, {\n    key: \"onViewportChange\",\n    value: function onViewportChange(event) {\n      var _this$props3 = this.props,\n          updateViewport = _this$props3.updateViewport,\n          windowId = _this$props3.windowId;\n      var viewport = event.eventSource.viewport;\n      updateViewport(windowId, {\n        flip: viewport.getFlip(),\n        rotation: viewport.getRotation(),\n        x: Math.round(viewport.centerSpringX.target.value),\n        y: Math.round(viewport.centerSpringY.target.value),\n        zoom: viewport.zoomSpring.target.value\n      });\n    }\n    /** */\n\n  }, {\n    key: \"addAllImageSources\",\n    value: function addAllImageSources() {\n      var _this3 = this;\n\n      var zoomAfterAdd = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var _this$props4 = this.props,\n          nonTiledImages = _this$props4.nonTiledImages,\n          infoResponses = _this$props4.infoResponses;\n      Promise.all(infoResponses.map(function (infoResponse) {\n        return _this3.addTileSource(infoResponse);\n      }), nonTiledImages.map(function (image) {\n        return _this3.addNonTiledImage(image);\n      })).then(function () {\n        if (infoResponses[0] || nonTiledImages[0]) {\n          if (zoomAfterAdd) _this3.zoomToWorld();\n\n          _this3.refreshTileProperties();\n        }\n      });\n    }\n    /** */\n\n  }, {\n    key: \"addNonTiledImage\",\n    value: function addNonTiledImage(contentResource) {\n      var canvasWorld = this.props.canvasWorld;\n      var viewer = this.state.viewer;\n      var type = contentResource.getProperty('type');\n      var format = contentResource.getProperty('format') || '';\n      if (!(type === 'Image' || type === 'dctypes:Image' || format.startsWith('image/'))) return Promise.resolve();\n      return new Promise(function (resolve, reject) {\n        if (!viewer) {\n          reject();\n        }\n\n        viewer.addSimpleImage({\n          error: function error(event) {\n            return reject(event);\n          },\n          fitBounds: _construct(OpenSeadragon.Rect, _toConsumableArray(canvasWorld.contentResourceToWorldCoordinates(contentResource))),\n          index: canvasWorld.layerIndexOfImageResource(contentResource),\n          opacity: canvasWorld.layerOpacityOfImageResource(contentResource),\n          success: function success(event) {\n            return resolve(event);\n          },\n          url: contentResource.id\n        });\n      });\n    }\n    /**\n     */\n\n  }, {\n    key: \"addTileSource\",\n    value: function addTileSource(infoResponse) {\n      var canvasWorld = this.props.canvasWorld;\n      var viewer = this.state.viewer;\n      return new Promise(function (resolve, reject) {\n        if (!viewer) {\n          reject();\n        } // OSD mutates this object, so we give it a shallow copy\n\n\n        var tileSource = _objectSpread({}, infoResponse.json);\n\n        var contentResource = canvasWorld.contentResource(infoResponse.id);\n        if (!contentResource) return;\n        viewer.addTiledImage({\n          error: function error(event) {\n            return reject(event);\n          },\n          fitBounds: _construct(OpenSeadragon.Rect, _toConsumableArray(canvasWorld.contentResourceToWorldCoordinates(contentResource))),\n          index: canvasWorld.layerIndexOfImageResource(contentResource),\n          opacity: canvasWorld.layerOpacityOfImageResource(contentResource),\n          success: function success(event) {\n            return resolve(event);\n          },\n          tileSource: tileSource\n        });\n      });\n    }\n    /** */\n\n  }, {\n    key: \"refreshTileProperties\",\n    value: function refreshTileProperties() {\n      var canvasWorld = this.props.canvasWorld;\n      var world = this.state.viewer.world;\n      var items = [];\n\n      for (var i = 0; i < world.getItemCount(); i += 1) {\n        items.push(world.getItemAt(i));\n      }\n\n      items.forEach(function (item, i) {\n        var contentResource = canvasWorld.contentResource(item.source['@id'] || item.source.id);\n        if (!contentResource) return;\n        var newIndex = canvasWorld.layerIndexOfImageResource(contentResource);\n        if (i !== newIndex) world.setItemIndex(item, newIndex);\n        item.setOpacity(canvasWorld.layerOpacityOfImageResource(contentResource));\n      });\n    }\n    /**\n     */\n\n  }, {\n    key: \"fitBounds\",\n    value: function fitBounds(x, y, w, h) {\n      var immediately = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n      var viewer = this.state.viewer;\n      viewer.viewport.fitBounds(new OpenSeadragon.Rect(x, y, w, h), immediately);\n    }\n    /**\n     * infoResponsesMatch - compares previous tileSources to current to determine\n     * whether a refresh of the OSD viewer is needed.\n     * @param  {Array} prevTileSources\n     * @return {Boolean}\n     */\n\n  }, {\n    key: \"infoResponsesMatch\",\n    value: function infoResponsesMatch(prevInfoResponses) {\n      var infoResponses = this.props.infoResponses;\n      if (infoResponses.length === 0 && prevInfoResponses.length === 0) return true;\n      if (infoResponses.length !== prevInfoResponses.length) return false;\n      return infoResponses.every(function (infoResponse, index) {\n        if (!prevInfoResponses[index]) {\n          return false;\n        }\n\n        if (!infoResponse.json || !prevInfoResponses[index].json) {\n          return false;\n        }\n\n        if (infoResponse.tokenServiceId !== prevInfoResponses[index].tokenServiceId) {\n          return false;\n        }\n\n        if (infoResponse.json['@id'] && infoResponse.json['@id'] === prevInfoResponses[index].json['@id']) {\n          return true;\n        }\n\n        if (infoResponse.json.id && infoResponse.json.id === prevInfoResponses[index].json.id) {\n          return true;\n        }\n\n        return false;\n      });\n    }\n    /**\n     * nonTiledImagedMatch - compares previous images to current to determin\n     * whether a refresh of the OSD viewer is needed\n     */\n\n  }, {\n    key: \"nonTiledImagedMatch\",\n    value: function nonTiledImagedMatch(prevNonTiledImages) {\n      var nonTiledImages = this.props.nonTiledImages;\n      if (nonTiledImages.length === 0 && prevNonTiledImages.length === 0) return true;\n      return nonTiledImages.some(function (image, index) {\n        if (!prevNonTiledImages[index]) {\n          return false;\n        }\n\n        if (image.id === prevNonTiledImages[index].id) {\n          return true;\n        }\n\n        return false;\n      });\n    }\n    /**\n     * zoomToWorld - zooms the viewer to the extent of the canvas world\n     */\n\n  }, {\n    key: \"zoomToWorld\",\n    value: function zoomToWorld() {\n      var immediately = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var canvasWorld = this.props.canvasWorld;\n      this.fitBounds.apply(this, _toConsumableArray(canvasWorld.worldBounds()).concat([immediately]));\n    }\n    /**\n     * Renders things\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$props5 = this.props,\n          children = _this$props5.children,\n          classes = _this$props5.classes,\n          label = _this$props5.label,\n          t = _this$props5.t,\n          windowId = _this$props5.windowId,\n          drawAnnotations = _this$props5.drawAnnotations;\n      var viewer = this.state.viewer;\n      var enhancedChildren = React.Children.map(children, function (child) {\n        return /*#__PURE__*/React.cloneElement(child, {\n          zoomToWorld: _this4.zoomToWorld\n        });\n      });\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"section\", {\n        className: classNames(ns('osd-container'), classes.osdContainer),\n        id: \"\".concat(windowId, \"-osd\"),\n        ref: this.ref,\n        \"aria-label\": t('item', {\n          label: label\n        }),\n        \"aria-live\": \"polite\"\n      }, drawAnnotations && /*#__PURE__*/React.createElement(AnnotationsOverlay, {\n        viewer: viewer,\n        windowId: windowId\n      }), enhancedChildren, /*#__PURE__*/React.createElement(PluginHook, Object.assign({\n        viewer: viewer\n      }, _objectSpread(_objectSpread({}, this.props), {}, {\n        children: null\n      })))));\n    }\n  }]);\n\n  return OpenSeadragonViewer;\n}(Component);\nOpenSeadragonViewer.defaultProps = {\n  children: null,\n  drawAnnotations: false,\n  infoResponses: [],\n  label: null,\n  nonTiledImages: [],\n  osdConfig: {},\n  viewerConfig: null\n};","import { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withTranslation } from 'react-i18next';\nimport { withStyles } from '@material-ui/core/styles';\nimport flatten from 'lodash/flatten';\nimport { withPlugins } from '../extend/withPlugins';\nimport { OpenSeadragonViewer } from '../components/OpenSeadragonViewer';\nimport * as actions from '../state/actions';\nimport { getVisibleCanvasNonTiledResources, getCurrentCanvas, getCanvasLabel, getViewer, getConfig, getCompanionWindowsForContent, selectInfoResponses, getCurrentCanvasWorld } from '../state/selectors';\n/**\n * mapStateToProps - used to hook up connect to action creators\n * @memberof Window\n * @private\n */\n\nvar mapStateToProps = function mapStateToProps(state, _ref) {\n  var windowId = _ref.windowId;\n  var canvasWorld = getCurrentCanvasWorld(state, {\n    windowId: windowId\n  });\n  var infoResponses = selectInfoResponses(state);\n  var imageServiceIds = flatten(canvasWorld.canvases.map(function (c) {\n    return c.imageServiceIds;\n  }));\n  return {\n    canvasWorld: canvasWorld,\n    drawAnnotations: getConfig(state).window.forceDrawAnnotations || getCompanionWindowsForContent(state, {\n      content: 'annotations',\n      windowId: windowId\n    }).length > 0 || getCompanionWindowsForContent(state, {\n      content: 'search',\n      windowId: windowId\n    }).length > 0,\n    infoResponses: imageServiceIds.map(function (id) {\n      return infoResponses[id];\n    }).filter(function (infoResponse) {\n      return infoResponse !== undefined && infoResponse.isFetching === false && infoResponse.error === undefined;\n    }),\n    label: getCanvasLabel(state, {\n      canvasId: (getCurrentCanvas(state, {\n        windowId: windowId\n      }) || {}).id,\n      windowId: windowId\n    }),\n    nonTiledImages: getVisibleCanvasNonTiledResources(state, {\n      windowId: windowId\n    }),\n    osdConfig: getConfig(state).osdConfig,\n    viewerConfig: getViewer(state, {\n      windowId: windowId\n    })\n  };\n};\n/**\n * mapDispatchToProps - used to hook up connect to action creators\n * @memberof ManifestListItem\n * @private\n */\n\n\nvar mapDispatchToProps = {\n  updateViewport: actions.updateViewport\n};\nvar styles = {\n  osdContainer: {\n    flex: 1,\n    position: 'relative'\n  }\n};\nvar enhance = compose(withStyles(styles), withTranslation(), connect(mapStateToProps, mapDispatchToProps), withPlugins('OpenSeadragonViewer'));\nexport default enhance(OpenSeadragonViewer);","var compareAscending = require('./_compareAscending');\n\n/**\n * Used by `_.orderBy` to compare multiple properties of a value to another\n * and stable sort them.\n *\n * If `orders` is unspecified, all values are sorted in ascending order. Otherwise,\n * specify an order of \"desc\" for descending or \"asc\" for ascending sort order\n * of corresponding values.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {boolean[]|string[]} orders The order to sort by for each property.\n * @returns {number} Returns the sort order indicator for `object`.\n */\nfunction compareMultiple(object, other, orders) {\n  var index = -1,\n      objCriteria = object.criteria,\n      othCriteria = other.criteria,\n      length = objCriteria.length,\n      ordersLength = orders.length;\n\n  while (++index < length) {\n    var result = compareAscending(objCriteria[index], othCriteria[index]);\n    if (result) {\n      if (index >= ordersLength) {\n        return result;\n      }\n      var order = orders[index];\n      return result * (order == 'desc' ? -1 : 1);\n    }\n  }\n  // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications\n  // that causes it, under certain circumstances, to provide the same value for\n  // `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247\n  // for more details.\n  //\n  // This also ensures a stable sort in V8 and other engines.\n  // See https://bugs.chromium.org/p/v8/issues/detail?id=90 for more details.\n  return object.index - other.index;\n}\n\nmodule.exports = compareMultiple;\n","var arrayFilter = require('./_arrayFilter'),\n    baseRest = require('./_baseRest'),\n    baseXor = require('./_baseXor'),\n    isArrayLikeObject = require('./isArrayLikeObject');\n\n/**\n * Creates an array of unique values that is the\n * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)\n * of the given arrays. The order of result values is determined by the order\n * they occur in the arrays.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Array\n * @param {...Array} [arrays] The arrays to inspect.\n * @returns {Array} Returns the new array of filtered values.\n * @see _.difference, _.without\n * @example\n *\n * _.xor([2, 1], [2, 3]);\n * // => [1, 3]\n */\nvar xor = baseRest(function(arrays) {\n  return baseXor(arrayFilter(arrays, isArrayLikeObject));\n});\n\nmodule.exports = xor;\n","var arrayMap = require('./_arrayMap'),\n    baseGet = require('./_baseGet'),\n    baseIteratee = require('./_baseIteratee'),\n    baseMap = require('./_baseMap'),\n    baseSortBy = require('./_baseSortBy'),\n    baseUnary = require('./_baseUnary'),\n    compareMultiple = require('./_compareMultiple'),\n    identity = require('./identity'),\n    isArray = require('./isArray');\n\n/**\n * The base implementation of `_.orderBy` without param guards.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function[]|Object[]|string[]} iteratees The iteratees to sort by.\n * @param {string[]} orders The sort orders of `iteratees`.\n * @returns {Array} Returns the new sorted array.\n */\nfunction baseOrderBy(collection, iteratees, orders) {\n  if (iteratees.length) {\n    iteratees = arrayMap(iteratees, function(iteratee) {\n      if (isArray(iteratee)) {\n        return function(value) {\n          return baseGet(value, iteratee.length === 1 ? iteratee[0] : iteratee);\n        }\n      }\n      return iteratee;\n    });\n  } else {\n    iteratees = [identity];\n  }\n\n  var index = -1;\n  iteratees = arrayMap(iteratees, baseUnary(baseIteratee));\n\n  var result = baseMap(collection, function(value, key, collection) {\n    var criteria = arrayMap(iteratees, function(iteratee) {\n      return iteratee(value);\n    });\n    return { 'criteria': criteria, 'index': ++index, 'value': value };\n  });\n\n  return baseSortBy(result, function(object, other) {\n    return compareMultiple(object, other, orders);\n  });\n}\n\nmodule.exports = baseOrderBy;\n","var baseEach = require('./_baseEach'),\n    isArrayLike = require('./isArrayLike');\n\n/**\n * The base implementation of `_.map` without support for iteratee shorthands.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction baseMap(collection, iteratee) {\n  var index = -1,\n      result = isArrayLike(collection) ? Array(collection.length) : [];\n\n  baseEach(collection, function(value, key, collection) {\n    result[++index] = iteratee(value, key, collection);\n  });\n  return result;\n}\n\nmodule.exports = baseMap;\n","var eq = require('./eq'),\n    isArrayLike = require('./isArrayLike'),\n    isIndex = require('./_isIndex'),\n    isObject = require('./isObject');\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nmodule.exports = isIterateeCall;\n","var baseFlatten = require('./_baseFlatten'),\n    baseOrderBy = require('./_baseOrderBy'),\n    baseRest = require('./_baseRest'),\n    isIterateeCall = require('./_isIterateeCall');\n\n/**\n * Creates an array of elements, sorted in ascending order by the results of\n * running each element in a collection thru each iteratee. This method\n * performs a stable sort, that is, it preserves the original sort order of\n * equal elements. The iteratees are invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {...(Function|Function[])} [iteratees=[_.identity]]\n *  The iteratees to sort by.\n * @returns {Array} Returns the new sorted array.\n * @example\n *\n * var users = [\n *   { 'user': 'fred',   'age': 48 },\n *   { 'user': 'barney', 'age': 36 },\n *   { 'user': 'fred',   'age': 30 },\n *   { 'user': 'barney', 'age': 34 }\n * ];\n *\n * _.sortBy(users, [function(o) { return o.user; }]);\n * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 30]]\n *\n * _.sortBy(users, ['user', 'age']);\n * // => objects for [['barney', 34], ['barney', 36], ['fred', 30], ['fred', 48]]\n */\nvar sortBy = baseRest(function(collection, iteratees) {\n  if (collection == null) {\n    return [];\n  }\n  var length = iteratees.length;\n  if (length > 1 && isIterateeCall(collection, iteratees[0], iteratees[1])) {\n    iteratees = [];\n  } else if (length > 2 && isIterateeCall(iteratees[0], iteratees[1], iteratees[2])) {\n    iteratees = [iteratees[0]];\n  }\n  return baseOrderBy(collection, baseFlatten(iteratees, 1), []);\n});\n\nmodule.exports = sortBy;\n","var isSymbol = require('./isSymbol');\n\n/**\n * Compares values to sort them in ascending order.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {number} Returns the sort order indicator for `value`.\n */\nfunction compareAscending(value, other) {\n  if (value !== other) {\n    var valIsDefined = value !== undefined,\n        valIsNull = value === null,\n        valIsReflexive = value === value,\n        valIsSymbol = isSymbol(value);\n\n    var othIsDefined = other !== undefined,\n        othIsNull = other === null,\n        othIsReflexive = other === other,\n        othIsSymbol = isSymbol(other);\n\n    if ((!othIsNull && !othIsSymbol && !valIsSymbol && value > other) ||\n        (valIsSymbol && othIsDefined && othIsReflexive && !othIsNull && !othIsSymbol) ||\n        (valIsNull && othIsDefined && othIsReflexive) ||\n        (!valIsDefined && othIsReflexive) ||\n        !valIsReflexive) {\n      return 1;\n    }\n    if ((!valIsNull && !valIsSymbol && !othIsSymbol && value < other) ||\n        (othIsSymbol && valIsDefined && valIsReflexive && !valIsNull && !valIsSymbol) ||\n        (othIsNull && valIsDefined && valIsReflexive) ||\n        (!othIsDefined && valIsReflexive) ||\n        !othIsReflexive) {\n      return -1;\n    }\n  }\n  return 0;\n}\n\nmodule.exports = compareAscending;\n"],"sourceRoot":""}